!function(){"use strict";var e={508:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.RESPONSE_TYPE=t.CALL_TYPE=void 0,t.CALL_TYPE="simple-iframe-rpc-call",t.RESPONSE_TYPE="simple-iframe-rpc-response"},370:function(e,t,n){const s=n(508);t.Z=class{constructor(e){this.methods=e}send(e,t){Promise.resolve(t).then((t=>this.sendResult(e,t))).catch((t=>this.sendError(e,t)))}sendResult(e,t){const{channel:n,id:r}=e.data,a=e.source||this.fallbackSource,o=e.origin&&"null"!==e.origin?e.origin:"*";a.postMessage({"@rpc":s.RESPONSE_TYPE,channel:n,id:r,result:t},o)}sendError(e,t){const{channel:n,id:r}=e.data,a=e.source||this.fallbackSource,o=e.origin&&"null"!==e.origin?e.origin:"*";a.postMessage({"@rpc":s.RESPONSE_TYPE,channel:n,id:r,error:t},o)}listen(e,t){e.addEventListener("message",(e=>{if("*"!==t&&e.origin!==t||e.data["@rpc"]!==s.CALL_TYPE)return;const{fn:n,args:r}=e.data;if(n in this.methods)try{this.send(e,this.methods[n](...r))}catch(t){this.sendError(e,t)}else this.sendError(e,`RPC method '${n}' is not defined`)}))}}}},t={};function n(s){var r=t[s];if(void 0!==r)return r.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,n),a.exports}n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};!function(){let e,t;function r(e){return Object.fromEntries(e.map((e=>[e.key,e.value])))}function a(e,n,s,r,a){return new Promise(((o,i)=>{t?(t.addEventListener("message",(t=>{if("err"in t.data)return void i(new Error(`Ownable ${e} failed`,{cause:t.data.err}));const n=t.data.get("result"),s=JSON.parse(n),r=t.data.has("mem")?JSON.parse(t.data.get("mem")).state_dump:a;o({response:s,state:r})}),{once:!0}),t.postMessage({type:e,ownable_id:n,msg:s,info:r,mem:{state_dump:a}})):i(`Unable to ${e}: not initialized`)}))}function o(e,t){return{attributes:r(e.attributes),events:(e.events||[]).map((e=>({type:e.type,attributes:r(e.attributes)}))),data:e.data,state:t}}async function i(t,n){return(await a("query",e,t,{},n)).response}async function c(e,t){const n=await i(e,t);return JSON.parse(atob(n))}n.r(s),new(n(370).Z)({init:function(n,s,r){return e=n,new Promise((async(e,n)=>{const a=new Blob([s],{type:"application/javascript"}),o=URL.createObjectURL(a);t=new Worker(o,{type:"module"}),t.onmessage=t=>{e(t.data)},t.onerror=e=>n(e),t.onmessageerror=e=>n(e);const i=r.buffer;t.postMessage(i,[i])}))},instantiate:async function(t,n){const{response:s,state:o}=await a("instantiate",e,t,n);return{attributes:r(s.attributes),state:o}},execute:async function(t,n,s){const{response:r,state:i}=await a("execute",e,t,n,s);return o(r,i)},externalEvent:async function(t,n,s){const r={info:n};console.log("external event call with ",t,r);const{response:i,state:c}=await a("external_event",e,t,r,s);return o(i,c)},query:c,queryRaw:i,refresh:async function(t){const n=await c({get_widget_state:{}},t);document.getElementsByTagName("iframe")[0].contentWindow.postMessage({ownable_id:e,state:n},"*")}}).listen(window,"*"),window.addEventListener("message",(e=>{"null"!==e.origin||"@rpc"in e.data||window.parent.postMessage(e.data,"*")}))}();var r=self;for(var a in s)r[a]=s[a];s.__esModule&&Object.defineProperty(r,"__esModule",{value:!0})}();
//# sourceMappingURL=ownable.js.map